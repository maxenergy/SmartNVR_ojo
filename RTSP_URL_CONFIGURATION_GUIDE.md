# RTSP URL配置指南

## 🔍 **问题诊断**

### **黑屏问题的常见原因**

1. **网络地址不匹配**
   - 默认URL使用错误的网段（如192.168.31.x vs 192.168.1.x）
   - 端口配置错误（如8554 vs 554）

2. **MPP解码器初始化失败**
   - 视频编码格式不支持
   - 硬件解码器资源不可用
   - RTSP流格式不兼容

3. **网络连接问题**
   - 摄像头设备离线
   - 网络防火墙阻止连接
   - 认证信息错误

## 📋 **正确的RTSP URL格式**

### **基本格式**
```
rtsp://[用户名:密码@]主机地址[:端口]/路径
```

### **示例配置**

#### **海康威视摄像头**
```
rtsp://admin:password@192.168.1.100:554/Streaming/Channels/101
rtsp://admin:password@192.168.1.100:554/h264/ch1/main/av_stream
```

#### **大华摄像头**
```
rtsp://admin:password@192.168.1.101:554/cam/realmonitor?channel=1&subtype=0
```

#### **通用IP摄像头**
```
rtsp://admin:password@192.168.1.102:554/1/1
rtsp://admin:password@192.168.1.103:554/live
```

#### **当前项目使用的URL**
```
rtsp://admin:sharpi1688@192.168.1.2:554/1/1
rtsp://admin:sharpi1688@192.168.1.127
rtsp://admin:sharpi1688@192.168.1.3:554/1/1
rtsp://admin:123456@192.168.1.210:554/ch01.264
```

## 🔧 **配置步骤**

### **1. 检查网络连接**
```bash
# 检查摄像头是否在线
ping 192.168.1.2

# 检查RTSP端口是否开放
telnet 192.168.1.2 554
```

### **2. 验证RTSP URL**
使用VLC媒体播放器测试：
1. 打开VLC
2. 媒体 → 打开网络串流
3. 输入RTSP URL
4. 播放测试

### **3. 修改应用配置**

#### **方法1：修改Settings.java（推荐）**
```java
// 在Settings.java的fromDisk方法中
s.cameras.add(new Camera("摄像头1", "rtsp://admin:your_password@192.168.1.100:554/1/1"));
s.cameras.add(new Camera("摄像头2", "rtsp://admin:your_password@192.168.1.101:554/1/1"));
```

#### **方法2：通过应用设置界面**
1. 启动应用
2. 进入设置界面
3. 修改RTSP URL配置
4. 保存并重启应用

## 🛠 **故障排除**

### **黑屏问题解决步骤**

1. **检查日志输出**
   ```
   adb logcat | grep -E "(RTSP|MPP|decoder)"
   ```

2. **常见错误信息及解决方案**

   **错误**: `❌ Failed to initialize MppDecoder, result: 1`
   **原因**: MPP解码器不支持该视频格式
   **解决**: 
   - 检查摄像头编码设置（推荐H.264）
   - 降低视频分辨率和码率
   - 尝试不同的RTSP路径

   **错误**: `⚠️ decoder is NULL in on_track_frame_out`
   **原因**: 解码器初始化失败
   **解决**: 
   - 检查RTSP URL是否正确
   - 验证网络连接
   - 重启应用

   **错误**: `URL validation passed` 但仍然黑屏
   **原因**: URL格式正确但内容无法解码
   **解决**:
   - 使用VLC验证RTSP流
   - 检查摄像头视频编码设置
   - 尝试不同的流路径

### **网络配置检查**

1. **确认摄像头IP地址**
   ```bash
   # 扫描网络中的设备
   nmap -sn 192.168.1.0/24
   ```

2. **检查摄像头Web界面**
   - 浏览器访问：`http://192.168.1.100`
   - 登录并检查RTSP设置
   - 确认用户名密码

3. **防火墙设置**
   - 确保554端口未被阻止
   - 检查路由器端口转发设置

## 📱 **应用内错误提示**

应用现在会显示以下提示信息：

- ✅ "正在连接 X 路RTSP视频流..."
- ✅ "RTSP视频流连接成功"
- ❌ "视频流连接异常，请检查网络和设备"
- ❌ "未找到有效的RTSP URL配置"

## 🔄 **测试流程**

1. **修改配置文件**
2. **清除应用数据**（强制重新读取配置）
3. **重新安装应用**
4. **检查日志输出**
5. **验证视频显示**

## 📞 **技术支持**

如果问题仍然存在，请提供以下信息：
- 摄像头品牌和型号
- 网络配置信息
- 完整的logcat日志
- RTSP URL配置
- 摄像头Web界面截图
